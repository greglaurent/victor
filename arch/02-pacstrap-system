#!/usr/bin/env bash

### PARTIAL SCRIPT ######
### REQUIRES PROMPTS ####

output 'Installing the base system (it may take a while).'

pacstrap /mnt base base-devel linux linux-lts linux-headers linux-firmware dkms \
  btrfs-progs e2fsprogs dosfstools xfsprogs nilfs-utils zram-generator lm_sensors fwupd dmraid device-mapper \
  grub grub-btrfs efibootmgr \
  snapper snap-pac apparmor \
  networkmanager iptables-nft ufw openssh chrony reflector fail2ban bind nfs-utils wpa_supplicant \
  cups cups-filters cups-pdf \
  pipewire-alsa pipewire-pulse pipewire-jack alsa-firmware alsa-plugins alsa-utils \
  tree curl perl less nano vim man-pages man-db wget diffutils logrotate cronie clang git inotify-tools neovim \
  xdg-utils xdg-user-dirs

# sbctl

if [ "${virtualization:?}" = 'none' ]; then
  CPU=$(grep vendor_id /proc/cpuinfo)
  if [[ "${CPU}" == *"AuthenticAMD"* ]]; then
    microcode=amd-ucode
  else
    microcode=intel-ucode
  fi

  pacstrap /mnt "${microcode}"
fi

unpriv cat ./etc/fwupd/fwupd.conf | tee /mnt/etc/fwupd/fwupd.conf >/dev/null

# echo 'UriSchemes=file;https' | sudo tee -a /mnt/etc/fwupd/fwupd.conf

#TODO: Figure out better desktop step
# pacstrap /mnt flatpak plasma-meta sddm zsh \
#   kitty wezterm
